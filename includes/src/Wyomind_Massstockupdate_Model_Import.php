<?php ini_set('memory_limit',"\61\60\62\64\x30\x4d");
 class Wyomind_Massstockupdate_Model_Import extends Mage_Core_Model_Abstract { public $_warnings = array();  public $_notices = array();  public $_sql = array();  public $_columns = array();  public $_products = array();  public $_stocks = array();  public $_autoInc = 0;  public $_tables = array();  public $_total = false;  public $_is_in_stock = false;  public $x19 = false;  public $_output = array();  public $x1a = array();  public function _construct() { $x63="\x69\x6ei_s\145\x74";  $x64="\x73\164\x72\x69\x73\x74r";  $x65="i\163\x5f\x72\145a\x64\141\142\x6c\x65";  $x66="\164im\145";  $x67="\x66i\154\145_\147\x65\x74\137\143o\156\164en\164s";  $x68="\151n_a\162r\141\x79";  $x69="im\160l\157d\x65";  $x6a="\x61\x72\162\x61\171_\153e\x79\x5f\145x\x69\163\x74s";  $x6b="trim";  $x6c="\163\164\x72\137\162\x65p\154\141c\145";  $x6d="l\x6f\x67";  $x6e="i\163\x5f\141\162\162\141\x79";  $x6f="\x6aso\156\137e\x6e\143\157\144\x65";  $x70="js\157n_\x64\x65\143\157\x64\145";  $x71="a\x72\x72\x61\171_\163\x70\x6cice";  $x72="\x61\162\162\x61y_un\163h\151\146\164";  $x73="\143ou\x6et";  $x74="\151s\x5f\156u\155\145\162\151\143";  $x75="\x61\x72\x72\x61\171\137\160\165\163\x68";  $x76="\x73\x74r\164\157\154\x6f\167\145\x72";  $x77="\x73t\x72\x73\164r";  $x78="ex\160\x6c\x6f\144\145";  $x79="\141\144\x64\x73l\141\163\x68es";  parent::_construct();  $this->_init("\x6da\163\163s\164\x6fc\x6bupd\x61\164\x65\57\151\155\x70\x6f\x72\164");  } protected function _beforeSave() { $x63="\x69\156\151\137\163et";  $x64="\163\x74\162\151\163t\162";  $x65="\x69s_\162\x65\x61\x64\141b\154\145";  $x66="ti\x6de";  $x67="f\x69\x6c\x65\137\147\145\164\x5f\x63\157\156\164\x65\156\x74\x73";  $x68="\151n_\141\x72ra\x79";  $x69="\x69\155p\x6c\157d\x65";  $x6a="\141r\x72\x61\x79_\153\145y\x5f\x65\x78\151s\164\163";  $x6b="\x74\x72\151\155";  $x6c="\163\x74\162\137\162e\160l\141\143e";  $x6d="\x6c\x6fg";  $x6e="\x69\163\137a\x72\162\x61\x79";  $x6f="j\163o\x6e\x5f\x65\156\143\157de";  $x70="\x6a\x73\157n_\x64\145\x63o\144\145";  $x71="arr\141y_s\x70\x6c\151c\x65";  $x72="ar\x72\x61\171\137u\156s\x68ift";  $x73="c\x6funt";  $x74="\x69\163\137\x6eu\155\x65r\151\143";  $x75="\x61\x72\162a\x79\137p\165\x73h";  $x76="strt\157lo\167e\162";  $x77="\x73\x74rs\164r";  $x78="\x65\170\160lode";  $x79="\141\144ds\154\141s\x68\145\163";  if ($this->getFileSystemType() !== "\61") { $x1b = new Varien_Io_File();  $x1c = $x1b->getCleanPath(Mage::getBaseDir() . "\x2f" . $this->getFilePath());  if (!$x1b->fileExists($x1c, false)) { Mage::throwException(Mage::helper("m\141\x73\163s\164\157c\153\x75\160\x64\x61\x74\145")->__("W\x72\x6fng\x20\146ile\40\x70\x61t\150\x2e\40\x27\x25s' \x69s\40\156\157\164 \141 \146\151\x6c\145\56", $x1c));  } if ($x64($this->getFilePath(), "\56c\163\x76") < 0) { Mage::throwException(Mage::helper("m\141\x73\163s\164\157c\153\x75\160\x64\x61\x74\145")->__("\127\162o\x6e\x67\x20\x66il\x65\56\40\47\45s'\x20i\x73\x20\156\x6f\x74\40\x61 \x63\x73\x76\x20\146il\145.", $x1c));  } if (!$x65($x1c)) { Mage::throwException(Mage::helper("m\141\x73\163s\164\157c\153\x75\160\x64\x61\x74\145")->__("P\154\x65\x61s\145 \x6da\x6b\145\x20s\x75re\x20\164h\x61\x74 \47\x25s\x27\x20\151s\x20\162e\141da\x62\154e\40\x62y \167eb\x2d\163\x65r\x76\145r\x2e", $x1c));  } } return parent::_beforeSave();  } public function x7a() { $x63="\x69\x6ei_s\145t";  $x64="\163tr\x69\163\x74\x72";  $x65="is\137\162e\x61\144\x61b\x6ce";  $x66="\164i\155e";  $x67="\x66\x69l\145\x5fg\145\164_c\x6f\156\x74e\156\x74\163";  $x68="\151n\x5f\x61r\162\x61y";  $x69="im\x70\154\157de";  $x6a="\141r\x72\141y_\x6b\145\171\x5f\x65\170\x69\163\164\163";  $x6b="\x74\x72i\x6d";  $x6c="\x73\x74\x72_r\x65\x70\154\141\x63\145";  $x6d="\x6cog";  $x6e="is\137a\x72r\x61\x79";  $x6f="\152\163on_\x65\x6e\143\x6f\144e";  $x70="\152\x73o\156\137\x64\x65\143o\x64\145";  $x71="\141\x72\162a\x79_s\160\x6c\x69c\x65";  $x72="\x61r\x72\x61\x79\x5f\165\x6e\163hif\164";  $x73="\x63\x6fun\x74";  $x74="\151\x73\137n\x75\155eric";  $x75="\x61\162r\x61\x79_\x70\165\x73h";  $x76="\163\164r\164\157\x6c\157\167\x65\x72";  $x77="st\162\x73tr";  $x78="e\170\160\154\x6fd\x65";  $x79="ad\144s\x6cas\x68\145\163";  $this->_warnings = array();  $this->_notices = array();  $this->_sql = array();  $this->_columns = array();  $this->_products = array();  $this->_stocks = array();  $this->_autoInc = 0;  $this->_tables = array();  $this->_total = false;  $this->_output = array();
 } private function x7b() { $x63="ini\x5f\163\145\x74";  $x64="\163\164\x72\x69\163tr";  $x65="\x69\x73\137r\x65\x61d\x61\x62\154e";  $x66="\x74\151m\x65";  $x67="\x66\x69\x6ce\x5f\x67\145\164\137\x63o\156\x74\145\x6e\x74s";  $x68="\151\156\137ar\162ay";  $x69="im\x70\154\157\144\145";  $x6a="a\162\162ay_\153\x65y\x5f\145xis\x74\163";  $x6b="\x74r\x69m";  $x6c="\163tr\137r\145\160\x6c\x61\x63\145";  $x6d="l\157g";  $x6e="i\x73\137\x61\162\162\141\x79";  $x6f="\152\x73o\156_\x65\x6e\x63ode";  $x70="\152\x73o\x6e_d\145c\157\x64\145";  $x71="\x61r\162a\x79\x5f\x73\160\x6c\151ce";  $x72="\x61rr\x61y_un\163\x68\151\146t";  $x73="\x63o\165n\x74";  $x74="is\x5f\156u\x6d\145\x72i\143";  $x75="a\162\162a\x79\137p\x75\163h";  $x76="str\x74\157\154\157\x77\x65\x72";  $x77="\163\x74\x72\163\164\x72";  $x78="e\x78\x70\154od\x65";  $x79="\x61d\144sl\141\x73\150\145\x73";  $x1d = $this->getFtpHost();  $x1e = $this->getFtpLogin();  $x1f = $this->getFtpPassword();  $x20 = $this->getFtpDir();  $x21 = $this->getUseSftp();  $x22 = $this->getFtpActive();  if ($x21) $x23 = new Varien_Io_Sftp();  else $x23 = new Varien_Io_Ftp();  try { $x23->open( array( 'host' => $x1d, 'user' => $x1e, 'username' => $x1e, 'password' => $x1f, 'timeout' => '120', 'path' => $x20, 'passive' => !($x22) ) );  if ($x23->cd($x20)) { $x24 = 'var/tmp/stock_import_' . $x66() . '.csv';  $x1b = new Varien_Io_File();  $x1c = $x1b->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  if ($x65($x1c)) { $x25 = $x23->read($this->getFilePath(), $x24);  $x23->close();  if (!$x25) { return array("T\x68\x65 \146\151l\145\x20\47".$this->getFilePath()."\x27 \x63\141\156\x6eot \142\x65 \146\145\x74\143\x68\145\x64.");  } return $x24;  } else { $x23->close();  return array("\120l\x65\141s\145\x20\155a\x6be \x73\x75\x72e\x20\x74\150\x61\164\40va\x72/\164\x6d\160\40\x69s\40\x77\162\x69\164a\142\154\x65\56");  } } else { $x23->close();  return array("Cannot access '$x20' on this server.");  } } catch (Exception $x26) { return $x26->getMessage();  } } public function x7c($x27,$x28) { $x63="\x69n\151_\163et";  $x64="\163\x74ris\164\x72";  $x65="\151\163\x5f\x72\x65\x61\x64\141b\154\145";  $x66="\164\x69m\x65";  $x67="\146i\154\x65\x5f\x67\145\x74\x5f\x63\x6f\x6e\x74e\156\x74\163";  $x68="\x69\156\137\141\162\162\x61\171";  $x69="\x69\155\x70\x6c\157\x64e";  $x6a="\x61\162\x72\141y\137\153ey\137\x65x\151\163\x74s";  $x6b="t\162\x69\x6d";  $x6c="st\162\137\x72\x65\160\154\141c\x65";  $x6d="\154\157\x67";  $x6e="\x69\x73_\141\x72r\x61\x79";  $x6f="json\137\145\x6eco\x64\145";  $x70="\152so\156\x5f\x64e\x63\x6f\144\145";  $x71="\141\162r\141\x79_\x73\x70\x6cice";  $x72="\141\162\162a\171\137u\x6eshi\146t";  $x73="c\x6f\x75\x6e\164";  $x74="i\163_\156um\145\x72\x69c";  $x75="a\x72\162\141y\x5f\160\x75s\150";  $x76="\x73t\x72t\x6f\x6c\157\x77\x65\162";  $x77="s\x74\x72st\x72";  $x78="e\x78\x70lo\x64\x65";  $x79="\141dds\x6ca\163\150e\x73";  $x29 = new SimpleXMLElement($x67($x27));  $x29 = $x29->xpath($x28);  $x2a = array();  $x2b = array();  foreach ($x29 as $x2c) { $x2d = array();  foreach ($x2c as $x2e => $x2f) { if (!$x68($x2e, $x2a)) { $x2a[] = $x2e;  } $x2d[$x2e] = (string) $x2f;  } $x2b[] = $x2d;  } $x30 = $x69("\73", $x2a) . "\x0a";  $x31 = 0;  foreach ($x2b as $x2c) { $x2d = array();  foreach ($x2a as $x32) { if ($x6a($x32, $x2c)) { $x2d[] = $x6b($x6c("\x0a", "\40", $x2c[$x32]));  } else { $x2d[] = "";  } } $x30 .= $x69("\73", $x2d) . "\x0a";  } $x1b = new Varien_Io_File();  $x1b->setAllowCreateFolders(true);  $x1c = $x1b->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  $x1b->open(array('path' => $x1c));  $x33 = "m\x73u_".$x66() . "\56c\163\x76";  if ($x1b->isWriteable($x1c)) { $x1b->streamOpen($x1c.$x33,'w');  $x1b->streamWrite($x30);  $x1b->streamClose();  return "v\x61\162/\164\155\x70\x2f".$x33;  } else { return array("Cannot access '$x1c' on this server.");  } } public function importProcess() { $x63="in\x69_\x73\145\x74";  $x64="s\164\x72i\x73t\x72";  $x65="i\x73\x5fre\141\x64\141\x62l\x65";  $x66="\164ime";  $x67="f\x69\154\145\137\147et\137\143\157\156\164e\x6ets";  $x68="\x69n\137\x61\162\162a\171";  $x69="\151\x6dp\x6code";  $x6a="a\162\x72\x61y\x5f\x6b\145y\137e\170\151\x73\x74\x73";  $x6b="\164\x72\151\155";
 $x6c="\163\x74\162_r\145p\x6c\141ce";  $x6d="\x6c\x6f\x67";  $x6e="\151\x73\137a\162\x72\141\x79";  $x6f="\152s\157\156_e\156\143\157de";  $x70="js\157\x6e\137\144\145\x63\157d\145";  $x71="a\162\162\x61\x79\x5f\x73\160\154\151\x63e";  $x72="\x61r\162\141\171\x5f\x75\x6es\x68\151\x66\164";  $x73="\x63ou\156\164";  $x74="\151\163_\x6e\165\x6d\x65\162\151\143";  $x75="\x61r\162\x61y\x5fp\x75\x73h";  $x76="\x73\x74\x72t\x6flow\145\162";  $x77="\163\x74\x72\x73\x74\162";  $x78="\145\x78\x70lo\x64e";  $x79="\141\144\144\163\x6c\141s\x68es";  Mage::$x6d("-\x2d\55\x2d\55\55-\55\x2d\x2d\55---\55\55-\55\55\55\40\111M\x50O\x52\x54\x41T\x49\x4f\116\40PR\x4f\103\105\123\123 -\55\55---\55\x2d\55\x2d\55-\x2d--", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $this->x7a();  $x34 = $this->getFilePath();  if ($this->getFileSystemType() === "\61") { $x25 = $this->x7b();  if ($x6e($x25)) { $x35['status'] = 'error';  $x35['body'] = $x25[0];  die($x6f($x35));  } else { $x34 = $x25;  } } $x1b = new Varien_Io_File();  $x1c = $x1b->getCleanPath(Mage::getBaseDir() . "\x2f" . $x34);  if ($this->getFileType() === "\61") { $x33 = $this->x7c($x1c,$this->getXpathToProduct());  if ($x6e($x33)) { $x35['status'] = 'error';  $x35['body'] = $x33[0];  die($x6f($x35));  } $x1c = $x1b->getCleanPath(Mage::getBaseDir() . '/' . $x33);  } $x1b->streamOpen($x1c, "r");  Mage::$x6d("\x2d-\76\40\x46\151\x6c\x65\40\x6fpened\x20\x3a\40" . $x1c, null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x36 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163\x6bu";  $x2b = Mage::getModel("\x63\x61ta\x6cog\x2f\x70\x72\x6f\x64u\143t")->getCollection()->addAttributeToSelect($x36);  foreach ($x2b as $x37) { $this->_products[$x6b($x37->getData($x36))] = $x37->getId();  };  Mage::$x6d("\x2d\x2d\76 \x50r\157\144\x75\x63\164\x73 c\x6fll\x65ct\x65d", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  if (Mage::helper("\143\157\162\145")->isModuleEnabled("\x57\171\157\x6d\151\x6e\x64_Ad\x76\141\156\143\145\x64i\156\166\x65\x6e\x74o\162\171")) { $x38 = Mage::getModel("adv\x61\x6e\x63\145\144in\x76entory\57\x73\164\x6f\x63\153")->getCollection();  foreach ($x38 as $x39) { $this->_stocks[$x39->getProductId()] = $x39->getId();  };  Mage::$x6d("--\76 \x4c\157\x63\141\x6c \163\164\x6fck\163\40\143o\154\154\145\143\x74\145d\40\x28\x41d\166an\x63\145\x64\40In\166e\x6e\x74o\x72y\51", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  } $x3a = array("a\143" => "a\143\x74\x69\166\x61\164\x69\157\x6e\137\x63o\144\x65", "\141\153" => "act\x69\166\141\164\x69\157n\137key", "\142\165" => "bas\x65\x5fu\162\154", "\x6dd" => "\x6dd\65", "\164h" => "\x74h\151\x73", "\144m" => "\137\144e\x6d\x6f", "\x65xt" => "\x6d\x73\x69", "\x76e\x72" => "3.9.0");  $x3b = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65");  $x3c = $x3b->getConnection("\143o\162\x65_r\145\141d");  $this->_tables["cs\x69"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("\x63a\x74a\x6c\x6f\x67in\166\145n\x74\x6fry_st\157\x63k_\x69\x74e\x6d");  if (Mage::helper("\143\157\162\145")->isModuleEnabled("\x57\171\157\x6d\151\x6e\x64_Ad\x76\141\156\143\145\x64i\156\166\x65\x6e\x74o\162\171")) { $this->_tables["\141ip"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("ad\x76\141n\x63\x65\144i\x6e\x76\145\x6et\x6f\162\171_i\x74\145\x6d");  $this->_tables["a\x69\x73"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("a\x64\166a\156\143ed\x69\156ven\164\x6f\162\171\137s\164\157c\x6b");  $x3d = "S\x45\x4c\x45\103\124\40M\101\130\50\x69\x64\x29\x20A\x53\40\111\x4e\x43 \x46R\117M " . $this->_tables["\141ip"] . "\x20\x3b";  $x3e = $x3c->fetchAll($x3d);  $this->_autoInc = $x3e[0]["I\x4e\x43"];  Mage::$x6d("\x2d\55>\x20\x4d\x61x\x20\151n\143\162em\x65\x6e\x74\x20\146\x6f\165\x6ed\40\43" . $x3e[0]["I\x4e\x43"] . "\x28\101d\166\x61nc\x65\x64\40\111\156\x76e\x6e\x74o\x72\171\x29", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  } $x3f = array( "act\x69\166\141\164\x69\157n\137key" => Mage::getStoreConfig("\x6d\141\163s\163\164\x6f\x63\x6b\165p\x64\141t\145\57l\x69\143\x65\156s\x65\57\x61\x63ti\166at\151\157\x6e\137key"), "a\143\x74\x69\166\x61\164\x69\157\x6e\137\x63o\144\x65" => Mage::getStoreConfig("m\x61sss\164\x6fc\153u\x70\144\x61\x74\145/\x6c\x69ce\156s\145\x2fa\x63\164\151v\x61\x74\151\x6fn\137\x63\157\144\x65"), "bas\x65\x5fu\162\154" => Mage::getStoreConfig("\167\x65b\57\163e\x63ur\x65\x2f\142\x61\163\145_\165\162\x6c"), );  $x2a = $x70($this->getMapping());  foreach ($x2a->columns as $x2e => $x40) { if (!$x68($x40->id, array("not-u\x73\x65\x64", "\164\157\x74\141\x6c", "\x69\163_i\x6e_\163\x74\x6fc\153", "\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"))) { $this->_columns[] = $x40->id;  } elseif ($x68($x40->id, array("\164\157\x74\141\x6c"))) { $this->_columns[] = "\164\157\x74\141\x6c";  $this->_total = $x2e + 1;  } elseif ($x68($x40->id, array("\x69\163_i\x6e_\163\x74\x6fc\153"))) { $this->_columns[] = "\x69\163_i\x6e_\163\x74\x6fc\153";  $this->_is_in_stock = $x2e + 1;  } elseif ($x68($x40->id, array("\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"))) { $this->_columns[] = "\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153";  $this->_manage_local_stock = $x2e + 1;  } else { $this->_columns[] = false;  } } Mage::$x6d("\55->\40Co\x6c\x75mn\x20\155\x61p\160i\x6e\147\x20\x61\x6e\x61\x6c\171ze\x64", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  if ($x3f[$x3a["a\143"]] != $x3a["\x6dd"]($x3a["\x6dd"]($x3f[$x3a["\141\153"]]) . $x3a["\x6dd"]($x3f[$x3a["\142\165"]]) . $x3a["\x6dd"]($x3a["\x65xt"]) . $x3a["\x6dd"]($x3a["\x76e\x72"]))) { $$x3a["\x65xt"] = "\x76\x61\154i\144";  $$x3a["\164h"]->$x3a["\144m"] = true;  } else { $$x3a["\164h"]->$x3a["\144m"] = false;  $$x3a["\x65xt"] = "\x76\x61\154i\144";  } if (!isset($$x3a["\x65xt"]) || $$x3a["\164h"]->$x3a["\144m"]) { $$x3a["\164h"]->$x3a["\144m"] = true;  return $$x3a["\164h"];  } Mage::$x6d("--\76 \x50\162\145p\141\x72i\156\147\40\x4d\171\123\161l\40que\162\x69\x65s", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x41 = $this->getSkuOffset() - 1;  $x42 = new Varien_Io_File();  $x42->setAllowCreateFolders(true);  $x43 = Mage::getStoreConfig("m\141\163\x73\x73tock\165\x70\x64\141t\145/\x73\x65\x74\x74\151ng\163\57sq\x6c\137\146\x69\x6ce");  $x44 = Mage::getStoreConfig("\155\x61\x73\163\x73\x74\x6fc\x6b\165\x70dat\x65\x2f\x73\145\164\x74\x69ng\x73\57s\161\x6c_\144\x69\162");  $x1c = $x1b->getCleanPath(Mage::getBaseDir() . '/' . $x44);  if (!$x42->fileExists($x1c, false)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please create the specified folder "%s".', $x1c));  } if (!$x42->isWriteable($x1c)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please make sure that "%s" is writable by web-server.', $x1c));  } $x42->open(array('path' => $x44));  $x42->streamOpen($x43, 'w');  if ($this->getAutoSetTotal() == 2) { $x42->streamWrite("S\x45T \x66\x6f\162\x65\151g\x6e\137k\x65\171\x5fch\x65ck\x73=\60; ");  } if ($this->getFileType() === "\61") { $x45 = "\73";  $x46 = "\156on\145";  } else { $x45 = $this->getFileSeparator();  $x46 = $this->getFileEnclosure();  } if ($x46 != "\156on\145") { while (false !== ($x47 = $x1b->streamReadCsv($x45, $x46))) { $x48 = $x71($x47, $x41, 1);  $x72($x47, $x48[0]);  $this->x7d($x47);  foreach ($this->_sql as $x3d) { $x42->streamWrite($x6c(array("\x0a", "\40\40"), array("\40", ""), $x6b($x3d)) . "\x0a");  } } } else { while (false !== ($x47 = $x1b->streamReadCsv($x45))) { $x48 = $x71($x47, $x41, 1);  $x72($x47, $x48[0]);  $this->x7d($x47);  foreach ($this->_sql as $x3d) { $x42->streamWrite($x6c(array("\x0a", "\40\40"), array("\40", "\40"), $x6b($x3d)) . "\x0a");  } } } Mage::$x6d("-\55>\x20File\x20cl\x6fs\x65\x64\x20: " . $x1c . $x43, null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x1b->streamClose();  if ($this->getAutoSetTotal() == 2) { } $x42->streamClose();  if ($x73($this->_warnings)) Mage::getSingleton("\x63\x6f\x72\x65/\x73\x65\163\x73\x69on")->addError($x69("\x3cb\x72\76", ($this->_warnings)));  if (Mage::getStoreConfig("\155as\163\x73t\x6f\143\153\165\160dat\145/se\x74ti\156\x67\x73/sh_m\x6f\x64\x65")) { return true;  } $x49 = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getConnection("cor\145\x5f\167\x72\151t\x65");  $x49->beginTransaction();  $x4a = true;
 Mage::$x6d("\x2d-\x3e\x20\105\170\145\143\165t\x69\156\147 \x4d\x79\x53\161\154\x20\161\x75\x65\x72i\x65s", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x1b = new Varien_Io_File();  $x1b->streamOpen($x1c . $x43, "r");  while (false !== ($x3d = $x1b->streamRead(102400))) { try { $x49->exec($x3d);  } catch (Mage_Core_Exception $x26) { Mage::$x6d("\x20\x66\141i\154e\x64\40-->" . $x3d, null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x4a = false;  } catch (Exception $x26) { Mage::$x6d("\x20\x66\141i\154e\x64\40-->" . $x3d, null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  Mage::getSingleton("\x63\x6f\x72\x65/\x73\x65\163\x73\x69on")->addError($x26->getMessage());  $x4a = false;  } } if (!$x4a) { Mage::$x6d("\x2d\x2d>\40\x4d\x79\x53\161\154\x20\122\157\x6clb\141\143k", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  Mage::getSingleton("\x63\x6f\x72\x65/\x73\x65\163\x73\x69on")->addError(Mage::helper("m\141\x73\163s\164\157c\153\x75\160\x64\x61\x74\145")->__("Er\162or \x77\x68\x69\x6ce\40\160ro\143\145s\163\151\156\x67. \x52ollb\x61\x63k\x20\150\141p\160\145n\145\144."));  $x49->rollback();  return false;  } else { Mage::$x6d("\x2d\x2d\76 M\x79S\161\154\x20\103\157mm\x69t", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x49->commit();  $this->setImportedAt(Mage::getSingleton("\x63\157\x72e\x2fda\164\x65")->gmtDate("Y\55\x6d\55\x64\x20\x48\x3a\x69\x3as"));  $this->save();  $x4b = Mage::getSingleton('index/indexer')->getProcessByCode('cataloginventory_stock');  $x4b->reindexAll();  Mage::$x6d("\x2d-\x3e\x20\123\164\157\x63\x6b\40\x72\145-\x69\x6ed\x65\x78\145\x64", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x1b->open(array('path' => $x44));  $x1b->rm($x43);  return true;  } } private function x7d($x4c) { $x63="\x69\156\x69_\163e\164";  $x64="\x73\x74\162\x69\163\164r";  $x65="is_re\x61\144\x61\142le";  $x66="t\151me";  $x67="\x66\151\x6ce_\x67\145\164\137c\157\x6et\x65nts";  $x68="\151\156_\x61r\x72\141\171";  $x69="\x69\x6d\x70\154\x6f\x64e";  $x6a="a\162r\141\171\x5fk\x65\x79\137\x65x\151st\163";  $x6b="\x74\162\x69\155";  $x6c="\x73\164\x72_\162\x65\x70\x6c\x61\x63\x65";  $x6d="log";  $x6e="\151\x73\x5f\x61\x72\x72a\171";  $x6f="\x6a\163\x6f\x6e_\145\156\x63\x6f\144\145";  $x70="\x6a\x73\x6f\156\137\144e\143\157d\145";  $x71="\141\x72\162a\x79_\x73\x70\x6c\151\143\145";  $x72="\141\x72\x72a\171\x5f\165\x6e\x73h\x69f\x74";  $x73="c\157u\156\x74";  $x74="\x69s\x5f\156u\155\145\x72\151\143";  $x75="\141r\x72\x61\x79\x5fp\165\x73\150";  $x76="\163\164\x72t\x6f\x6co\167\x65\x72";  $x77="s\x74\x72str";  $x78="\145\x78\x70lo\144\145";  $x79="addsl\x61s\x68e\163";  $this->_sql = array();  foreach ($x4c as $x4d => $x4e) $x4c[$x4d] = $x6b($x4e);  if ($this->getUseCustomRules()) { $x4f = $this->getCustomRules();  eval($x6c('$C[', '$x4c[', $x4f));  } $x50 = array();  $x51 = array();  $x36 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163\x6bu";  $x52 = Mage::getModel('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $x36)->getFrontendLabel();  if (isset($this->_products[$x4c[0]])) { $x53 = $this->_products[$x4c[0]];  if (isset($this->_stocks[$x53])) { $x54 = $this->_stocks[$x53];  } else { $this->_autoInc++;  $x54 = $this->_autoInc ;  } $x50["\111\104"] = $x53;  $x55 = true;  $x50["\x73tatu\x73"] = $x55;  $x50["\164\157\x74\141\x6c"] = 0;  $x50["i\156\x5f\163t\x6f\143\153"] = null;  $x56 = 0;  foreach ($x4c as $x2e => $x2f) { if (isset($this->_columns[$x2e - 1]) && $x2e > 0) { if (!$this->_total) { if ($x74($x2f) && $x55) { if ($this->_columns[$x2e - 1] != "\164\157\x74\141\x6c" && $this->_columns[$x2e - 1] != "\x69\163_i\x6e_\163\x74\x6fc\153" && ($this->_columns[$x2e - 1] == "u\x73\x65d" || $x74($this->_columns[$x2e - 1]))) $x50["\164\157\x74\141\x6c"]+=$x2f;  $x55 = true;  } } else { if ($this->_total && $this->_columns[$x2e - 1] == "\164\157\x74\141\x6c") { $x50["\164\157\x74\141\x6c"] = $x2f;  if ($x74($x2f)) $x55 = true;  else $x55 = false;  } } if (Mage::helper("\143\157\162\145")->isModuleEnabled("\x57\171\157\x6d\151\x6e\x64_Ad\x76\141\156\143\145\x64i\156\166\x65\x6e\x74o\162\171") && $x55) { if ($x74($x2f) && $x74($this->_columns[$x2e - 1])) { $x57 = " RE\120\x4c\x41\x43\105\x20IN\x54\117 `" . $this->_tables["a\x69\x73"] . "` \50\140i\x64\x60\x2c\x20`lo\x63\141ls\x74oc\x6b\137\x69\x64\x60\x2c\140p\x6c\141\143e\x5f\x69\144`\x2c\140q\165\141\156\x74\151\164\171\x5f\151n_\163\x74\x6f\143\x6b\140,`\160\x72\x6fd\x75\143\x74\137\x69\144`\x2c`\142\141c\x6b\x6f\162\x64e\x72\x5f\x61\x6c\x6co\167ed\x60\x2c\x60\165\x73\x65\x5f\x63\157\156\146\151\147\137\x73\x65\x74\x74\x69n\x67\x5ff\157\x72\x5f\142\x61\143\x6bor\144e\162\163\x60\51 \166a\x6c\x75\x65s\x28\15\x0a\40 \40 \x20 \40\x20\40 \x20\40\40\x20 \x20\x20\40 \x20 \x20\40\40\x20 \40\40\40\40\x20\x20\x20\x49\x46\x28(\123EL\105\x43\x54\40cou\x6e\164\50\x60\x69\144\140) \x46\122\117M `" . $this->_tables["a\x69\x73"] . "\x60\x20\x41\123\x20\x61\x20\x57\x48\105R\x45\40\x60\160\x6c\x61c\145_i\144\x60\x3d" . $this->_columns[$x2e - 1] . "\x20A\x4e\x44 \x20\140\x70\162\157\144\165\143t\137i\x64\140\x3d" . $x53 . ")\75\61\54(S\105\114\105\x43T\40\140\x69\x64\140\x20\x46\122\117\x4d " . $this->_tables["a\x69\x73"] . " \101\x53\40a\40\127\110\x45\x52\x45 `\160\154a\143e\137\151\x64`=" . $this->_columns[$x2e - 1] . "\40\x41\116D\x20\140\160\162\157\x64\165c\x74\x5f\151d\140=" . $x53 . "),NULL) ,$x54," . $this->_columns[$x2e - 1] . ",$x2f,$x53,IFNULL((SELECT `backorder_allowed` FROM `" . $this->_tables["a\x69\x73"] . "\140 \101\x53 `b\x60\40\127\110ER\x45\x20\140p\154a\x63\x65_\x69\144\140=" . $this->_columns[$x2e - 1] . "\40\x41\116D\x20\140\160\162\157\x64\165c\x74\x5f\151d\140=" . $x53 . "\51,\60\51\54\111\106\116\x55L\x4c((\123ELEC\x54\40\x60us\145\x5f\143\x6fnfig\137\163\145tti\156\147\x5f\146or\x5f\x62ac\x6b\157\x72d\145r\163`\x20\x46\x52\x4f\x4d\x20`" . $this->_tables["a\x69\x73"] . "\140\40AS\x20\x60\x63\x60 \127\x48\105\122\105\x20\140\x70\154\141c\145\137id\140\x3d" . $this->_columns[$x2e - 1] . "\40\x41\116D\x20\140\160\162\157\x64\165c\x74\x5f\151d\140=" . $x53 . ")\x2c\61\x29); ";  $x75($this->_sql, $x57);  $x51[] = "\55\111\x46\x4e\125LL\50(\x53\x45\x4cE\x43T\40`\x71\165a\x6et\x69\164y_\x69\x6e_\x73t\157\143k`\x20F\122O\115\40`" . $this->_tables["a\x69\x73"] . "\140\x20\127\110\105\x52E\x20\140\x70\x6c\x61\143\x65\x5f\151d`\x3d" . $this->_columns[$x2e - 1] . "\x20A\x4e\x44 \x20\140\x70\162\157\144\165\143t\137i\x64\140\x3d" . $x53 . " )\x2c\x30\x29";  } } if (!$this->getAutoSetInstock()) { if ($this->_is_in_stock && $this->_columns[$x2e - 1] == "\x69\163_i\x6e_\163\x74\x6fc\153") { if ($x68($x76($x2f), array("\61", "t\162\165\145", "\x79\145\163", "\157\x6e", "in\x20\163\x74\x6f\143\x6b", "\x69n\x73t\x6f\143\x6b", "a\166\141\x69\x6ca\x62l\x65"))) $x50["i\156\x5f\163t\x6f\143\153"] = true;  else $x50["i\156\x5f\163t\x6f\143\153"] = false;  } } else { if ($x50["\164\157\x74\141\x6c"] > 0) $x50["i\156\x5f\163t\x6f\143\153"] = true;  else $x50["i\156\x5f\163t\x6f\143\153"] = false;  } if ($this->_manage_local_stock && $this->_columns[$x2e - 1] == "\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153") { if ($x68($x76($x2f), array("\61", "t\162\165\145", "\x79\145\163", "\157\x6e", "in\x20\163\x74\x6f\143\x6b", "\x69n\x73t\x6f\143\x6b", "a\166\141\x69\x6ca\x62l\x65"))) $x50["\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"] = 1;  else $x50["\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"] = 0;  } else { $x50["\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"] = 1;  } if ($x77($this->_columns[$x2e - 1], "at\164rib\165\164\145")) { $x58 = ($x78('-', $this->_columns[$x2e - 1]));  $x59 = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("\x63\141\x74\x61$x6d\x5fpr\x6f\x64\165\x63\x74\x5f\145\156\x74it\x79_" . $x58[3]);  $x57 = "UPDATE `$x59` SET `value`='" . $x79($x2f) . "'\x20\127\110\x45\x52E\40\140\x65\156\164\x69\x74\171\137\x69\x64`\75'" . $x53 . "'\40\x41\x4e\x44\x20\x60\x61\164\x74r\151\142\x75\164e\x5f\x69\x64\140\75'" . $x58[2] . "'; ";  $x75($this->_sql, $x57);  } $x50[$x56]["\x76\x61\x6c\165e"] = $x2f;  $x50[$x56]["\143\157\144\x65"] = $this->_columns[$x2e - 1];  $x56++;  } };  $x50["\x73tatu\x73"] = $x55;  $x5a = $x50["\164\157\x74\141\x6c"];  if ($this->getAutoSetTotal() == 2) { if ($x73($x51)) $x5a = "(\123\x45L\105\103\x54 \x28IF\116\x55\x4c\x4c\x28\123\125\115\50\x60\161ua\156\164\x69\164y_i\156\x5f\x73\164\157ck\140),\60\51" . $x69('', $x51) . "+$x5a) FROM " . $this->_tables["a\x69\x73"] . " WHERE `product_id`=$x53)";  else { $x55 = false;  } } $x5b = $x50["i\156\x5f\163t\x6f\143\153"];  if (Mage::helper("\143\157\162\145")->isModuleEnabled("\x57\171\157\x6d\151\x6e\x64_Ad\x76\141\156\143\145\x64i\156\166\x65\x6e\x74o\162\171")) { if ($x55) { $x57 = "R\105\120\x4cA\103\x45 \111\x4e\124\117\x20\140" . $this->_tables["\141ip"] . "` values($x54,$x53," . $x50["\155\x61n\x61g\x65\137l\x6f\x63\141l\137\163\x74o\x63\153"] . "); ";  $x72($this->_sql, $x57);  } } if (($x55)) { if ($x5b === true || $x5b === false) { $x5c = ",\40\140is\x5fi\156\137st\x6f\143k\140";  $x5d = ($x5b) ? '=1' : '=0';  if ($this->getAutoSetTotal() == 2) { $x5d = "= IF ($x5a>0,1,0)";
 } } else { $x5c = null;  $x5d = null;  } $x57 = "\x55\120D\101\x54\105\x20\140" . $this->_tables["cs\x69"] . "\x60\40S\x45\x54\40" . "`product_id`='$x53'," . "`qty`=$x5a," . "`s\164oc\153\x5f\151\144\x60\75 \61" . "$x5c $x5d WHERE `product_id`='$x53'; ";  $x72($this->_sql, $x57);  } if ($x55) { $this->_notices[] = "$x52 <i>$x4c[0]</i> has been updated";  } else { Mage::$x6d("\x2a P\162o\x64\165\x63\164\x20\43" . $x4c[0] . "\x20\x68a\163 be\145\156 \x69\147\156\157\162ed \144u\x65\x20\164\157 \163\x6f\x6de\x20n\x6f\156\40c\157\156s\x69s\164\x65\156\x74 \x64\x61ta\56", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $this->_warnings[] = "$x52 <i>$x4c[0]</i> has been ignored due to some non consistent data.";  } $this->_output[] = $x50;  } else { Mage::$x6d("\x2a P\162o\x64\165\x63\164\x20\43" . $x4c[0] . " \x64\157es\156\x27\164 \145\170\151\x73\x74\56\x20\120\x72\157\x64uc\164\x20\150\141s \142\x65e\156\x20\151\x67\x6eo\x72ed.", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $this->_warnings[] = "$x52 <i>$x4c[0]</i> doesn't exist. Product has been ignored.";  } } function backup() { $x63="\151n\151\137s\x65t";  $x64="stris\164r";  $x65="\x69\163_r\145\141\144\x61\x62\154e";  $x66="\x74\151m\x65";  $x67="\146\x69\154\145_\x67\x65t_cont\145\x6et\163";  $x68="i\156\137\x61\x72\x72\141\171";  $x69="\151\x6d\160\x6c\x6fde";  $x6a="\x61\162\x72\x61\171\137k\145\171_\x65\170\x69\163\x74s";  $x6b="\164r\151\155";  $x6c="s\164r\137\x72\x65\x70\x6c\x61c\x65";  $x6d="\154\x6f\147";  $x6e="\151s_\141\162\x72\x61y";  $x6f="\152\163\x6fn\x5f\145\156\143\x6f\144\x65";  $x70="\x6as\157\156\x5fde\x63o\x64\145";  $x71="\x61r\x72a\x79\137\x73\160\154ic\145";  $x72="\141\x72\x72ay\137\x75n\163\x68\x69\x66\164";  $x73="\x63o\165n\x74";  $x74="is_nu\x6d\145\x72i\x63";  $x75="a\162\162\x61\171_\x70\x75\x73\150";  $x76="\x73tr\164o\x6c\157w\145\162";  $x77="s\x74\x72s\x74\x72";  $x78="\x65x\x70lod\x65";  $x79="\141\x64d\x73\x6c\x61\x73\150\145\x73";  $x3d = array();  $x5e = array();  $x5f = array();  $x3b = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65");  $x3c = $x3b->getConnection("\143o\162\x65_r\145\141d");  $this->_tables["cs\x69"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("\x63a\x74a\x6c\x6f\x67in\166\145n\x74\x6fry_st\157\x63k_\x69\x74e\x6d");  $this->_tables["c\160\x65"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("\143\141t\141\154\x6f\x67_\x70\162od\165\143\164\137e\156\x74\x69\164\x79");  $x75($x3d, "\114\105\x46T\x20\112\117\111N\x20`" . $this->_tables["c\160\x65"] . "` \101\x53\40\x60cpe\x60\x20ON\40`\x63\160\145`.\140e\x6e\x74\x69\x74\x79\x5f\151\x64\140\x3d`\x63\x73\x69\x60\x2e\x60\x70\162\157d\165ct\137\151\x64\140");  if (Mage::helper("\143\157\162\145")->isModuleEnabled("\x57\171\157\x6d\151\x6e\x64_Ad\x76\141\156\143\145\x64i\156\166\x65\x6e\x74o\162\171")) { $x5e[] = null;  $x5f[] = null;  $this->_tables["a\x69\x73"] = Mage::getSingleton("c\x6f\x72e\57re\x73\x6f\165\162\x63\x65")->getTableName("a\x64\166a\156\143ed\x69\156ven\164\x6f\162\171\137s\164\157c\x6b");  $x60 = Mage::getModel("\160\157i\156t\157\x66\x73\141\x6ce\57p\x6fi\x6e\x74o\x66\163\141l\145")->getPlaces();  foreach ($x60 as $x37) { $x75($x3d, "\114\105\x46T\x20\112\117\111N\x20`" . $this->_tables["a\x69\x73"] . "\140 \101S `\141i\137" . $x37->getPlaceId() . "\140\x20\117N\40`a\x69\137" . $x37->getPlaceId() . "`\56`\160r\x6fduc\x74\137\x69\x64\x60=\140cp\145\x60\56\x60e\156\164\151\x74\171\x5f\x69d\x60\40AN\104 \140\141\151_" . $x37->getPlaceId() . "`\56`p\154\141\143\x65_id`\75" . $x37->getPlaceId() . "");  $x5e[] = "\x61\151\x5f" . $x37->getPlaceId() . "\56`\x71\165a\156\x74\151\x74y\x5fi\x6e\137\163\x74\x6f\143\x6b` A\x53 \140ai_\x73\x74o\143\x6b\x5f" . $x37->getPlaceId() . "\x60";  } } $x72($x3d, "\x53E\114\105C\x54 \140\143\x70\145`.\140\163k\x75`\40" . $x69(', ', $x5e) . "\54\40\x60\143s\151\140\x2e\140q\x74\171\140,\x60\143s\x69\x60\x2e`\151s\137\x69\x6e\x5fs\164o\143\x6b\140 F\x52\x4f\x4d\40`" . $this->_tables["cs\x69"] . "\140\40A\x53\x20`\x63\163i\140");  $x75($x3d, "\x57\110\105\122\105\40`\163\x6bu\x60 \111\x53\x20NOT\x20\116\x55LL\x20" . $x69(" A\x4eD\40", $x5f) . "");  Mage::$x6d("-\x2d\55\x2d---\55-\55-\55\55\55\x2d-\55\x2d\55\55\x20BAC\113U\120\40P\122O\103\105\123S\40\55\55\x2d\x2d--\55\55\55-\x2d\x2d-\55\55-\x2d\x2d--", null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  Mage::$x6d("\55\x2d\55\76\x20\x4dyS\x71\x6c\x20\x72\x65\x71\165\x65\x73\x74\40\72\40" . $x69(' ', $x3d), null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  $x4c = $x3c->fetchAll($x69("\40", $x3d));  $x1b = new Varien_Io_File();  $x1b->setAllowCreateFolders(true);  $x27 = Mage::getStoreConfig("\x6d\141\x73\x73\163\164\157c\153u\x70d\x61\x74\x65\57\x73\145\164\x74\151\156\147s\x2f\x62ack\x75p\x5ffi\x6c\145") . "\x2d" . $x66() . "\56c\163\x76";  $x61 = Mage::getStoreConfig("\155\141\163\163\163toc\153u\160\x64\x61\164\x65\57\x73e\164\164\151\156\x67\x73\57\142\141ck\x75\x70\x5fd\151\162");  $x1b->open(array("\x70\141\164\x68" => Mage::getBaseDir() . "\x2f" . $x61));  if ($x1b->fileExists($x27) && !$x1b->isWriteable($x27)) { Mage::throwException(Mage::helper("\x6fr\x64\145\x72\x73e\170p\x6fr\164too\x6c")->__("\106\x69\x6c\x65\40\x27\x25\x73' \143\141\x6en\157\164\40\142e\40\163av\145\x64. Ple\x61\x73e\x2c\40\155\141ke\40s\x75r\x65 \x74\150\145 \144i\x72\145ct\157r\171\40\45\x73\47 \x69s\x20w\x72\x69\164eable \x62\171\x20w\x65\x62\x20ser\166e\162.", $x27, $this->getPath()));  } $x1b->streamOpen($x27, "\x77");  foreach ($x4c as $x62) { $x1b->streamWriteCsv($x62, "\73");  } $x1b->streamClose();  Mage::getSingleton("\x63\x6f\x72\x65/\x73\x65\163\x73\x69on")->addSuccess(Mage::helper("m\141\x73\163s\164\157c\153\x75\160\x64\x61\x74\145")->__("\x42\x61cku\160 \x63r\145a\x74e\x64\x20:\40\x20 '\x25s'\x2e", $x61 . $x27));  Mage::$x6d("---\76\40\x44\x4fN\x45\x20:\x20" . $x61 . $x27, null, "\x4dass\x53\x74\157\143\x6b\x55p\141t\x65\x2e\154\x6f\147");  return;  } }; 

