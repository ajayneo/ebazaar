<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); 
$stock = $this->getProductStock($_product);
$productSold = $this->getProductSoldQty($_product);
?>
<?php
$attributeSetModel = Mage::getModel("eav/entity_attribute_set");
$attributeSetModel->load($_product->getAttributeSetId()); // $product is your product object
$attributeSetName = $attributeSetModel->getAttributeSetName();

$gst_line = "** Avail benefits & offers of ".$attributeSetName." GST rate input on every 
purchase from electronicsbazaar.com";

?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);

    jQuery(document).ready(function($) {
        jQuery(".qty").on('blur',function(e){
            var qtyAvailable = jQuery(".maxqty").val();
            if(jQuery(".qty").val() > jQuery(".minqty").val()){
                alert('only '+qtyAvailable+" are available.");
            }
           // alert(jQuery(".qty").val());

        });
        
         
    })
    <?php /* ?>
    jQuery(document).ready(function($) {

        jQuery(".deal-btn").on('click',function(e){
            e.stopImmediatePropagation();
            jQuery(".deal-content").toggle("slow");
            jQuery(".deal-btn").toggleClass("deal-btn-1");

        });
    })
    <?php */ ?>
</script>

<?php /*if ($_product->getDealOnActive()) { ?>
    <?php
    $deal_on=$_product->getDealOn();
    $deal_on_products = Mage::getModel('catalog/product')
        ->getCollection()
        ->addAttributeToSelect('*')
        ->addAttributeToFilter('deal_on_active', 1)
        ->addAttributeToFilter('deal_on',array('eq'=>$deal_on))
        ->load();

    $count_deal_prod=count($deal_on_products->getAllIds());

    ?>
    <div class="deal-container">
        <?php if($count_deal_prod>1){ ?>
        <span class="deal-btn"><a href="#">Deals</a></span>
        <?php }?>
        <div class="deal-content">
            <div class="side_bar_deals">
                <h2>Other Exclusive Deals</h2>
                <ul>
                    <?php
                    $i=1;

                    foreach ($deal_on_products as $deal_prod) { ?>
                        <?php if ($deal_prod->getId() != $_product->getId()) {
                            if($i%2==0)
                            {
                                $class_alt="even";
                            }else{ $class_alt="odd";}

                            ?>
                            <li class="<?php echo $class_alt ?>">
                                <a href="<?php echo $deal_prod->getProductUrl(); ?>" class="product-image">
                                    <img
                                        src="<?php echo $this->helper('catalog/image')->init($deal_prod, 'small_image')->resize('100'); ?>"
                                        alt="<?php echo $deal_prod->getName(); ?>"/>
                                </a>

                                <div class="product-info">
                                    <h2 class="product-name"><a title="<?php echo $deal_prod->getName() ?>" href="<?php echo $deal_prod->getProductUrl(); ?>"><?php echo $deal_prod->getName() ?></a>
                                    </h2>

                                    <div class="price-box">
                                        <?php if($deal_prod->getSpecialPrice()) {?>
                                            <p class="old-price">
                                                <span class="price-label">MRP:</span>
                                    <span class="price"
                                          id="old-price-645"><?php echo Mage::helper('core')->formatPrice($deal_prod->getPrice(), false); ?></span>
                                            </p>
                                        <?php }?>

                                        <p class="special-price">
                                            <span class="price-label">Price</span>
                                    <span class="price"
                                          id="product-price-645"><?php echo Mage::helper('core')->formatPrice($deal_prod->getFinalPrice(), false); ?></span>
                                        </p>

                                    </div>

                                </div>
                            </li>
                            <?php
                            $i++;
                        } ?>
                    <?php } ?>
                </ul>
            </div></div></div>
<?php }*/ ?>



<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<?php echo $this->getChildHtml('ajax-addtocompare'); ?>
<?php //echo $o = Mage::getModel('review/review')->getReviewUrl(); ?>
<?php
$categoryModel = Mage::getModel('catalog/category');
$_categories = $_product->getCategoryIds();
?>
<?php $product_id = $_product->getId(); 
    // $stockItem = $_product->getStockItem()
?>
<?php $relatedProductsIds = $_product->getRelatedProductIds(); ?>
    <div class="product-view">
        <div class="product-essential">
        <form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if ($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
            <?php echo $this->getBlockHtml('formkey') ?>
            <div class="no-display">
                <input type="hidden" name="product" value="<?php echo $_product->getName() ?>" />
                <input type="hidden" name="related_product" id="related-products-field" value="" />
            </div>
            <div class="product-img-box" id="product-img-box">
                
                <?php if (!$_product->isSaleable()): ?>
                    <div class="outOfStock">
                        <div class="outOfStockImage"></div>
                    </div>  
                <?php endif; ?>
                <?php
                /**
                ///// Deal module is disabled
                *Add Deals Offer Tag on Product
                */
                /*$dealCollection = Mage::getModel('multipledeals/multipledeals')->getCollection()->addFieldToFilter('status', array('eq' => 1));
                $dealproductIds = array();
                if (count($dealCollection)) {
                    foreach ($dealCollection as $deal) {
                        $dealproductIds[] = $deal->getProductId();
                    }
                }
                $product_id = $_product->getId();
                if (in_array($product_id, $dealproductIds)) {
                    $customblocks_index = new Neo_Customblocks_Block_Index();
                    $discount_percent = $customblocks_index->getDealsDiscountPercent($_product->getId());
                    if ($discount_percent > 0):
                        ?>
                        <div class="tag"><p><?php echo $discount_percent; ?>% <span>Off</span></p></div>
                        <?php
                    endif;
                }
                if ($_product->getDealOnActive())
                {
                    $customblocks_index1 = new Neo_Customblocks_Block_Index();
                    $discount_percent = $customblocks_index1->getDiscountPercent($_product->getId());

                    if ($discount_percent > 0){
                        ?>
                        <div class="tag"><p><?php echo $discount_percent; ?>% <span>Off</span></p></div>
                    <?php   }
                }*/

                ?>
                <?php echo $this->getChildHtml('addto') ?>
                <?php echo $this->getChildHtml('media') ?>
                <!-- code added by jp for add add to cart button below media. -->
                <div class="btn-section">  
                 <?php if ($_product->isSaleable() && $_product->getPrice() > 0): ?>
                   <?php echo $this->getChildHtml('addtocart') ?>
                 <?php endif; ?>                 
                </div>                
            </div>

            <div class="product-shop">
                <div class="product-name">
                    <?php $brand = $_product->getAttributeText('brands'); ?>
                    <h1><span class="products_name"><?php echo $_product->getName(); ?></span>                   
                    <?php //deactivate vow delight on 27 Apr'18 Mahesh Gurav
                    /*if($brand == 'Vow'): ?>
                        <span class="vow-delight-btn"><a href="<?php echo Mage::getBaseUrl() ?>vowdelight/program/"><img src="https://www.electronicsbazaar.com/skin/frontend/rwd/revamp/images/new-images/vow-delight-button.png" alt="Vow Delight" /></a></span>
                    <?php endif;*/ ?>
                    </h1>
                </div>
                <?php if((int)$productSold[0]['total_qty_sold'] > 200){ ?>
                <div class="product-qty-sold">
                    <b><?php echo (int)$productSold[0]['total_qty_sold']; ?></b> Units Sold !!
                </div> 
                <?php } ?> 
                <div class="product-detail-section">
                    <div class="product-sec">
                        <?php #echo $this->getChildHtml('product_type_availability');  ?>
<!-- code commented by jp. <div class="short-description">
                            <p class="strong">Specification</p>
                            <div class="std clearfix">
                                <?php //echo $_helper->productAttribute($_product, $_product->getShortDescription(), 'short_description') ?>
                            </div>
                        </div> -->
                        <div class="product-details-content clearfix">
                            <div class="product-section-left">
                                <div class="clearfix">
                                    <div class="quanity-left">
                                        <div class="quantity-container clearfix">
                                            <div class="qty-label"><label>Quantity:</label></div>
                                            <div class="qty-field clearfix">
                                                <input type="text" class="input-text qty" title="Qty" value="1" maxlength="12" id="qty" name="qty">
                                                <!-- <input type="text" class="input-text minqty" title="Min Qty" value="<?php echo $stock->getMinQty()==0? 1 : (int)$stock->getMinQty(); ?>" maxlength="12" id="minqty" name="minqty">
                                                <input type="text" class="input-text maxqty" title="Max Qty" value="<?php echo (int)$stock->getQty(); ?>" maxlength="12" id="maxqty" name="maxqty"> -->
                                            </div>
                                        </div> 
                                        <?php if($_product->getNewLaunch()){ ?>
                                                <span class="coming_soon">Coming Soon</span>
                                        <?php }else{ ?>
                                        <?php if($stock->getQty() <= 10 && $_product->isSaleable() && $_product->getTypeId() !=="bundle"): ?>
                                            <div style="color: red;">
                                                <span>Hurry, Only <?php echo (int)$stock->getQty(); ?> left!</span>
                                            </div>
                                        <?php endif; 
                                        } ?>
                                        <?php // if(Mage::helper('customer')->isLoggedin()): ?>
                                            <div class="price-info">
                                                <?php echo $this->getPriceHtml($_product); ?>
                                                <?php echo $this->getChildHtml('bundle_prices') ?>
                                                <?php echo $this->getTierPriceHtml() ?>
                                                <?php if (!empty($discount_percent)): ?>
                                                    <?php $currency_code = Mage::app()->getStore()->getCurrentCurrencyCode(); ?>
                                                    <span class="tax">Save <span class="percentage"><?php echo Mage::app()->getLocale()->currency($currency_code)->getSymbol() . $discount_percent; ?></span></span>
                                                <?php endif; ?>
                                            </div>
                                        <?php // else: ?>
                                             <!-- <div class="product-info-custom">
                                                <a class="view-price" href="<?php // echo $this->getUrl('customer/account/login');?>">Login to view Price</a>
                                            </div> -->
                                        <?php // endif; ?>   
                                        <div class="short-description">
                                            <div class="c-prod-desc"><?php echo $_product->getImpDesc(); ?>
                                        </div>
                                    </div>                                                                     
                                    </div>
                                </div>
                                <div class="gst-info">
                                    <?php echo $gst_line; ?>
                                </div>
                                <!--  code commented by JP for remove add to cart button to below media. 
                                <div class="btn-section">
                                    <?php //if ($_product->isSaleable()): ?>
                                        <?php //echo $this->getChildHtml('addtocart') ?>
                                    <?php // endif; ?>
                                </div> -->
                            </div>
                            <div class="product-section-right">
                                <?php if($product_id == "19740"){ ?>
                                <div class="product-sticker"><img src="https://www.electronicsbazaar.com/skin/frontend/rwd/revamp/images/new-images/redmi-note4-sticker.png" alt="Online Electronics Shopping - ElectronicsBazaar"></div>
                                <?php } ?>
                                <div class="availability-container">
                                    <p class="strong">Delivery Option</p>
                                    <p>Enter your pincode to see your available delivery options</p>
                                    <?php 
                                        //Get the customer session and check if the customer is logged in
                                        if (Mage::getSingleton('customer/session')->isLoggedIn()) {
                                            $customer = Mage::getSingleton('customer/session')->getCustomer();
                                            $custPincode = $customer->getPincode();//get customer pincode
                                            $estimatedDelivery = $this->getProductDeliveryOnDetailsPage($custPincode);
                                            if($estimatedDelivery['status'] == 1){
                                                $class = 'success';
                                            }else{
                                                $class = 'error';
                                            }
                                        }else{
                                            $custPincode = NULL;
                                            $estimatedDelivery = '';
                                            $class = '';
                                        }
                                    ?>
                                    <div class="stock clearfix"><input id="pincodeCheck" name="" type="text" placeholder="Enter pincode" class="pincode" value="<?php echo $custPincode;?>" maxlength="6"><button type="button" title="Buy Now" class="button checkpostcode"><span><span>Check</span></span></button></div>
                                    <span class="pincode_message"></span>
                                    <span class='pincode_message_login <?php echo $class; ?>'>
                                        <?php if($estimatedDelivery != '' ) echo $estimatedDelivery['message']; ?>
                                    </span>
                                    
                                    <?php //echo $this->getChildHtml('product_type_availability');  ?>
                                </div>
                            </div>
                        </div>

                        <div class="warranty-container">
                            <div class="warranty-title">Warranty:</div>
                            <div class="warranty-content"><p><?php echo $_product->getWarrenty(); ?></p></div>
                        </div>

                        <div class="warranty-container">
                            <?php if($_product->getLaptopRemark()){ ?>                                            
                            <div class="warranty-title">Remarks:</div>
                            <div class="warranty-content"><p><?php echo $_product->getLaptopRemark(); ?></p></div>
                            <?php } ?>
                        </div>

                        <!-- code for free shipping, cod & easy emi logo. -->
                                   <?php if($product_id != '3266'):  //if condition is added for one sku told by mandar sir ?>
                                    <div class="pay-options">
                                        <ul class="clearfix">
                                            <?php if ($_product->getCashOnDelivery()): ?><li class="cod"><div class="option-image cash"></div><p class="info-text">Cash on Delivery</p></li><?php endif; ?>
                                            <?php if ($_product->getEmiOption()): ?><li class="emi_op"><div class="option-image emi-option"></div><p>Easy EMI</p></li><?php endif; ?>                                                                          
                                            <?php if ($_product->getFreeHomeDelivery()): ?><li class="ho_deli"><div class="option-image home-delivery"></div><p>Free Home Delivery</p></li><?php endif; ?>
                                        </ul>
                                    </div>
                                    <?php /* //added for phicomm on 22/08/2017 by Mahesh Gurav attribute code 2239
                                    if($_product->getBrands() == 12){ ?>
                                    <div class="phicomm-list"><a href="http://phicomm.in/service-centres/" target="_blank">Click here to know Phicomm Service Centres</a></div>
                                    <?php } */ ?>
                                   <?php endif; ?>
                                <!-- End code for free shipping, cod & easy emi logo. -->

                        <?php /* ?>
                        <div class="grade-container">
                            <div class="grade-title">Grade : <span>A</span></div>
                            <div class="grade-content">
                                Excellent Condition, Minor Signs of Use, Fully Functional, Professionally Tested &amp; No Scratches
                            </div>
                        </div> <?php */ ?>

                        
        <?php $setId = $_product->getAttributeSetId(); 
        $attributegroupcollections = array(); 
        if ($setId == '9') { 
            // this is for the laptops
            $attribute_groups_to_show = array('Product Details', 'Processor', 'RAM (Memory)', 'Storage(HDD)', 'Storage(HDD)', 'Display', 'Graphic Card Details', 'OPERATING SYSTEM', 'WARRANTY', 'Optical Drive', 'Power', 'PORTS/SLOTS' , 'Remark', 'Specifications' , 'Input'); 
        } elseif ($setId == '10') {
            // this is for the mobile
            $attribute_groups_to_show = array('General Features', 'Camera', 'RAM & Storage', 'Display', 'Internet & Connectivity', 'Battery', 'Platform', 'Other Details', 'Dimensions', 'Warranty');
            // $attribute_groups_to_show = array('General Features');
        } elseif ($setId == '11') {
            // this is for the cameras
            $attribute_groups_to_show = array('General Features', 'Technical Spec', 'Lens', 'LCD', 'Sensor', 'Battery', 'Dimensions', 'Warranty', 'In the Box');
        } elseif ($setId == '19') {
            // this is for the all-in-one-desktop
            $attribute_groups_to_show = array('Product Details', 'Processor & Chipset', 'RAM (Memory)', 'Storage(HDD)', 'Display', 'Graphics', 'Input Devices', 'Network', 'Operating System', 'Warranty', 'Optical Drive', 'In the Box', 'Webcam', 'PORTS/SLOTS', 'Dimensions');
        } elseif ($setId == '13') {
            // this is for the tablets
            $attribute_groups_to_show = array('Storage', 'General Features', 'Platform', 'Display', 'Camera', 'Battery', 'Multimedia', 'Internet & Connectivity', 'Warranty', 'Dimensions');
        } elseif ($setId == '22') {
            // this is for the headsets
            $attribute_groups_to_show = array('General Features', 'Microphone Features','Connectivity','Sound Features','Dimensions','Warranty');
        } elseif ($setId == '23') {
            // this is for the storage media
            $attribute_groups_to_show = array('General Features', 'Dimensions' ,'Warranty');
        } elseif ($setId == '25') {
            // this is for the monitors
            $attribute_groups_to_show = array('General Features', 'Display Features', 'Warranty', 'Power Features', 'Weight', 'Connectivity', 'Mounting Features', 'In the Box', 'System Requirements');
        } elseif ($setId == '27') {
            // this is for the keyboard and mouse
            $attribute_groups_to_show = array('General Features', 'Dimensions', 'Warranty');
        } elseif ($setId == '28') {
            // this is for the speakers
            $attribute_groups_to_show = array('General Features','Power','Dimensions','Audio Features','Connectivity','Warranty','In the Box','Additional Features');
        } elseif ($setId == '30') {
            // this is for the keyboard and mmc
            $attribute_groups_to_show = array('General Features');
        } elseif ($setId == '32') {
            // this is for the power bank
            $attribute_groups_to_show = array('General Features', 'Dimensions', 'Warranty', 'In the Box');
        } elseif ($setId == '33') {
            // this is for the tripod
            $attribute_groups_to_show = array('General Features', 'Dimensions', 'LEG FEATURES');
        } elseif ($setId == '34') {
            // this is for the camera memory card
            $attribute_groups_to_show = array('General Features');
        } elseif ($setId == '24') {
            // this is for the scanner
            $attribute_groups_to_show = array('General Feature', 'Scan', 'Copy', 'Dimensions', 'In the Box', 'Warranty', 'System Requirements');
        } elseif ($setId == '29') {
            // this is for the battery adapter
            $attribute_groups_to_show = array('General Features', 'Dimensions', 'Warranty');
        }elseif ($setId == '36') {
            // this is for the nd
            $attribute_groups_to_show = array('Product Details','Speed','Dimensions','Security','Power','Connectivity','System Requirements','Warranty Summary');
        }elseif ($setId == '31') {  
            // this is for the battery adapter
            $attribute_groups_to_show = array('General Features', 'Dimensions', 'Warranty', 'In the Box', 'Technical Spec', 'Lens Features');
        } elseif ($setId == '26') {
            // this is for the printer
            $attribute_groups_to_show = array('General Features', 'Dimensions & Weight', 'Scan', 'Compatible Inks/Toners', 'Sales Package', 'Paper Handling', 'Warranty', 'System Requirements', 'Connectivity', 'Print', 'Copy');
        } elseif ($setId == '37') {
            // this is for the bluetoothe
            $attribute_groups_to_show = array('General Features','Power and Battery','Sound Feature','Controls','Bluetooth','Wireless','Dimensions','Warranty','Microphone Features','Additional Features','In The Box');
        } elseif ($setId == '38') {
            // this is for the mobile cases and covers
            $attribute_groups_to_show = array('General Features','Warranty','Dimensions');
        }elseif ($setId == '40') {
            // this is for the led panel
           // $attribute_groups_to_show = array('General Features', 'Display', 'Dimensions', 'Battery', 'Warranty' ,'Connectivity Features' , 'Price');
            $attribute_groups_to_show = array('General Features','Power Features', 'Dimensions', 'Warranty');
        }
        elseif ($setId == '35') {
            // this is for the Laptop Bags
            $attribute_groups_to_show = array('General Features','Warranty','Dimensions');
        }
        elseif ($setId == '45') {
            // this is for the Cases & Covers
            $attribute_groups_to_show = array('General Features','Warranty');
        }
        elseif ($setId == '43') {
            // this is for the Cabels 
             
            $attribute_groups_to_show = array('General Features','Warranty');
        }
        elseif ($setId == '47') {
            // this is for the Refurbished   
             
            $attribute_groups_to_show = array('General Features','Warranty');
        }
        else {
            $attribute_groups_to_show = array('Specifications');
        }

        $groups = Mage::getModel('eav/entity_attribute_group')
                ->getResourceCollection()
                ->setAttributeSetFilter($setId)
                ->setSortOrder()
                ->load();

        foreach ($groups as $group) {
            if (in_array($group->getAttributeGroupName(), $attribute_groups_to_show)) {
                $attributegroupcollections[] = $group->getAttributeGroupId();
            }
        }
        $attributegroupcollectionswithname = array();  
            $attributeSetCollection = Mage::getResourceModel('eav/entity_attribute_group_collection')->load(); 
            foreach ($attributegroupcollections as $attributegroupcollection): 
                foreach ($attributeSetCollection as $id => $attributeGroup) {
                    if ($attributeGroup->getAttributeGroupId() == $attributegroupcollection):
                    $attributegroupcollectionswithname[$attributegroupcollection] = $attributeGroup->getAttributeGroupName();
                    endif;
                }
            endforeach;
            if (count($attributegroupcollectionswithname) > 0): ?>
        <div class="details-specification-container">
        <div class="specification-title"><h2>Specifications</h2> <span class="view-more">View More</span><span class="view-less">View Less</span></div>
        <div class="specification-details-container">
        <?php foreach ($attributegroupcollectionswithname as $key => $value): ?>
            <div class="specification-content-container">
            <div class="specification-content-title"><?php echo $value; ?></div>
                <ul class="clearfix">
                <?php $attributesCollections = Mage::getResourceModel('catalog/product_attribute_collection'); 
                 $attributesCollections->setAttributeGroupFilter($key); 
                // echo $count = count($attributesCollections->getData());
                foreach ($attributesCollections as $attribute): 
                    if ($attribute->getFrontendInput() == 'select' || $attribute->getFrontendInput() == 'boolean'): 
                    $sel_var_val = $_product->getAttributeText($attribute->getAttributeCode()); 
                        if (!empty($sel_var_val)): ?>
                            <li class="clearfix">
                                <div class="feature-title"><?php echo $attribute->getFrontendLabel(); ?></div>
                                <div class="feature-content"><?php echo $_product->getAttributeText($attribute->getAttributeCode()); ?></div>
                            </li>
                        <?php endif; 
                    elseif ($attribute->getFrontendInput() == "text"): 
                    $text_var_val = $_product->getData($attribute->getAttributeCode()); 
                         if (!empty($text_var_val)): ?>
                            <li class="clearfix">
                                <div class="feature-title"><?php echo $attribute->getFrontendLabel(); ?></div>
                                <div class="feature-content"><?php echo $_product->getData($attribute->getAttributeCode()); ?></div>
                            </li>
                        <?php endif; 
                    endif;  
                endforeach; ?>
                </ul>
            </div>
            <?php endforeach; ?>
            </div>
        </div>
        <?php endif; ?>
                        
                    </div>
                    <!-- <div class="product-options-bottom"> commented by jp.
                        <?php //echo $this->getPriceHtml($_product); ?>
                        <?php //echo $this->getChildHtml('bundle_prices') ?>
                        <?php //echo $this->getTierPriceHtml() ?>
                        <?php //echo $this->getChildHtml('productvideo');  ?>

                    </div> -->
                    <?php $customblocks_index = new Neo_Customblocks_Block_Index();  ?>
                    <?php $discount_percent = $customblocks_index->getDiscountPercentage($_product->getId()); ?>
                    <div class="product-bottom-sec">
                        <?php $offers = $_product->getOffers(); ?>
                        <?php if (!empty($offers)): ?>
                            <div class="offer-sec">
                                <?php $offers_array = explode(',', $offers); ?>
                                <?php $product = Mage::getModel('catalog/product'); ?>
                                <?php $attr = $product->getResource()->getAttribute("offers"); ?>
                                <?php if ($attr->usesSource()): ?>
                                    <?php foreach ($offers_array as $offer): ?>
                                        <?php $offer_label = $attr->getSource()->getOptionText($offer); ?>
                                        <?php $model = Mage::getModel("offers/offers")->getCollection()->addFieldToFilter('offer', $offer_label)->getFirstItem(); // check once ?>
                                        <div class="info-icon"><span>Offer</span></div>
                                        <span class="info-text"><?php echo $model->getData('offer'); ?><span title="<?php echo $model->getData('offer_desc'); ?>">[?]</span></span>
                                    <?php endforeach; ?>
                                <?php endif; ?>
                            </div>
                        <?php endif; ?>
                        <?php $brand_yes_no = $_product->getLaptopFreebag(); ?>
                    </div>
                </div>

                <!--<div class="extra-info">
                <?php //echo $this->getReviewsSummaryHtml($_product, 'default', false) ?>
                <?php //echo $this->getChildHtml('product_type_availability'); ?>
                                </div>-->

                <?php //echo $this->getChildHtml('alert_urls')  ?>

                <?php //echo $this->getChildHtml('other'); ?>

                <?php if ($_product->isSaleable() && $this->hasOptions()): ?>
                    <?php echo $this->getChildChildHtml('container1', '', true, true) ?>
                <?php endif; ?>
            </div>

            <div class="add-to-cart-wrapper">
                <?php echo $this->getChildHtml('product_type_data') ?>
                <?php echo $this->getChildHtml('extrahint') ?>
            </div>

            <?php //echo $this->getChildHtml('related_products')  ?>

            <div class="clearer"></div>

            <div class="bundled-optionscss">
                <?php if ($_product->isSaleable() && $this->hasOptions()): ?>
                    <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
                <?php endif; ?>
            </div>
        </form>
        <script type="text/javascript">
            //<![CDATA[
            var productAddToCartForm = new VarienForm('product_addtocart_form');
            productAddToCartForm.submit = function (button, url) {
                if (this.validator.validate()) {
                    var form = this.form;
                    var oldUrl = form.action;

                    if (url) {
                        form.action = url;
                    }
                    var e = null;
                    try {
                        this.form.submit();
                    } catch (e) {
                    }
                    this.form.action = oldUrl;
                    if (e) {
                        throw e;
                    }

                    if (button && button != 'undefined') {
                        button.disabled = true;
                    }
                }
            }.bind(productAddToCartForm);

            productAddToCartForm.submitLight = function (button, url) {
                if (this.validator) {
                    var nv = Validation.methods;
                    delete Validation.methods['required-entry'];
                    delete Validation.methods['validate-one-required'];
                    delete Validation.methods['validate-one-required-by-name'];
                    // Remove custom datetime validators
                    for (var methodName in Validation.methods) {
                        if (methodName.match(/^validate-datetime-.*/i)) {
                            delete Validation.methods[methodName];
                        }
                    }

                    if (this.validator.validate()) {
                        if (url) {
                            this.form.action = url;
                        }
                        this.form.submit();
                    }
                    Object.extend(Validation.methods, nv);
                }
            }.bind(productAddToCartForm);
            //]]>
        </script>
    </div>

    <?php #$relatedProductsIds = $_product->getRelatedProductIds(); ?>
    <?php $checkforbundled = "false"; ?>
    <?php foreach ($relatedProductsIds as $relatedProductsId): ?>
        <?php $product = Mage::getModel('catalog/product')->load($relatedProductsId); ?>
        <?php $productType = $product->getTypeID(); ?>
        <?php if ($productType == "bundle"): ?>
            <?php global $checkforbundled; ?>
            <?php $checkforbundled = "true"; ?>
            <?php break; ?>
        <?php endif; ?>
    <?php endforeach; ?>

    <?php /*
    <div class="taglist">
        <?php echo $this->getChildHtml("product_tag_list"); ?>
    </div>
    */
    ?>
    
            <?php if ($checkforbundled == "true"): ?>
    <div class="product-details-bottom">
        <div class="left_side">
                <div class="recommneded_combos">
                    <h2>Recommended Combos</h2>
                    <div class="recommneded_combos_container">
                        <ul id="combo-items">
                            <?php foreach ($relatedProductsIds as $relatedProductsId): ?>
                                <?php $product = Mage::getModel('catalog/product')->load($relatedProductsId); ?>
                                <?php $productType = $product->getTypeID(); ?>
                                <?php if ($productType == "bundle"): ?>
                                    <?php $price_check = $product->getFinalPrice(); ?>
                                    <?php
                                    $collection = $product->getTypeInstance(true)->getSelectionsCollection(
                                            $product->getTypeInstance(true)->getOptionsIds($product), $product);
                                    $collectioncount = count($collection);
                                    $i = 1;
                                    ?>
                <?php
                $bundled_items = array();
                $optionCollection = $product->getTypeInstance()->getOptionsCollection();
                $selectionCollection = $product->getTypeInstance()->getSelectionsCollection($product->getTypeInstance()->getOptionsIds());
                $options = $optionCollection->appendSelections($selectionCollection);
                foreach ($options as $option) {
                    $_selections = $option->getSelections();
                    foreach ($_selections as $selection) {
                        $bundled_items[$option->getOptionId()][] = $selection->getSelectionId();
                    }
                }
                ?>
                <li>
            <?php foreach ($collection as $item) { ?>
                <div class="combo-<?php echo $i; ?>">
                    <div class="product-image">
                        <div class="product-image-gallery">
                            <img src="<?php echo $this->helper('catalog/image')->init($item, 'small_image')->resize('210'); ?>" alt="<?php echo $item->getName(); ?>" />
                        </div>
                    </div>
                    <?php if ($price_check): ?>
                    <div class="product-info">
                        <div class="checkbox_sample sample">
                            <input type="checkbox" class="checkbox <?php echo 'product_' . $product->getId(); ?>" checked="checked" data-productsku="<?php echo $item->getSku(); ?>" />
                            <label class="css-labels" for="combo_<?php echo $i; ?>"><?php echo $item->getName(); ?></label>
                        </div>
                        <div class="price-info">
                            <div class="price-box">
                                <div class="regular-price">
                                    <span class="price"><?php //echo Mage::helper('core')->currency($item->getPrice());   ?>
                                        <?php echo Mage::helper('core')->currency($item->getPrice()); ?></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <?php else: ?>
                    <div class="product-info">
                        <div class="checkbox_sample sample">
                            <input type="checkbox" class="checkbox <?php echo 'product_' . $product->getId(); ?> checkboxchg" checked="checked" id="combo_<?php echo $i; ?>" data-parent="<?php echo 'product_' . $product->getId(); ?>" data-selectionid="<?php echo $item->getSelectionId(); ?>" data-combo_<?php echo $i; ?>="<?php echo $item->getSelectionId(); ?>" data-optionid="<?php echo $item->getOptionId(); ?>" data-selectionpricevalue="<?php echo $item->getSelectionPriceValue(); ?>" data-liprodid="<?php echo $product->getId(); ?>" data-parentprice="<?php echo $product->getPrice(); ?>"/>
                            <label class="css-label" for="combo_<?php echo $i; ?>"><?php echo $item->getName(); ?></label>
                        </div>
                        <div class="price-info">
                            <div class="price-box">
                                <div class="regular-price">
                                    <span class="price" id="<?php echo $item->getId(); ?>"><?php //echo Mage::helper('core')->currency($item->getPrice());   ?>
                                        <?php echo Mage::helper('core')->currency($item->getSelectionPriceValue()); ?></span>
                                </div>
                            </div>
                        </div>
                    </div>
                <?php endif; ?>
                </div>
                <?php if ($i < $collectioncount): ?>
                    <div class="plus-sec"><span class="plus-icon">+</span></div>
                    <?php $i++; ?>
                <?php endif; ?>
        <?php   } ?>
            <div class="buy-details buy-details_<?php echo $product->getId(); ?>">
            <?php foreach ($collection as $item): ?>
                <?php $items_price += $item->getSelectionPriceValue(); ?>
            <?php endforeach; ?>
            <span>Buy <?php echo $collectioncount; ?> items at </span>
            <div class="price-info">
                <div class="price-box">
                    <div class="regular-price">
                        <span class="price"><?php echo Mage::helper('core')->currency($product->getPrice() + $items_price); ?></span>
                    </div>
                </div>
            </div>
            <?php $product_list_block = new Mage_Catalog_Block_Product_List(); ?>
            <button data-bunid="<?php echo $product->getId(); ?>" class="button <?php
            if ($price_check): echo 'shopping-cart-rule';
            else: echo 'bundle-addto-cart';
            endif;
            ?>" title="Buy Now" type="button" data-prodid="<?php echo $product->getId(); ?>"><span><span>Add to Cart</span></span></button>
            </div>
        </li>
        <?php endif; ?>
    <?php endforeach; ?>
        </ul>
        </div>
    </div>
        <div id="seealldetails"></div>
    </div>
<?php endif; ?>
        <!-- </div> -->        
        <?php #echo $_product->getAttributeSetId(); ?>
        <?php #if (count($relatedProductsIds) == 0): ?>
            <?php $toplevel_categoryid = $customblocks_index->getTopLevelCategoryIfNoRelatedProducts($_product->getCategoryIds()); ?>
            <?php $products_fromcategory_related = $customblocks_index->getProductsFromCategoryForRelatedProducts($toplevel_categoryid->getId(),$_product->getBrands(),$_product->getPrice(),$_product->getAttributeSetId()); ?>
            <?php $relatedProductsIds = $products_fromcategory_related; ?>
        <?php #endif; ?>


        <div class="clr"></div>
    </div>
   
<?php //echo $this->getChildHtml('upsell_products')   ?>
<?php //echo $this->getChildHtml('product_additional_data')  ?>
<div id="footer">
<?php echo $this->getChildHtml('related') ?>
</div>
<?php echo $this->getChildHtml('product_recently_viewed') ?>
    <div class="shareurpopup">
        <div class="share-you-purchase-popup"></div>    
    </div>
</div>
<script type="text/javascript">
    jQuery(document).on('ready', function () {
        //remove ratings code on 18th May 2018 Mahesh Gurav

        jQuery('.checkpostcode').click(function () {
            var postcode = jQuery('.pincode').val();
            pincodeCheck(postcode);
        });

        // jquery to remove empty spec group. changed on the 6th Jan
        jQuery('.specification-container').each(function () {
            var len = jQuery(this).find('table tr').length;
            if (len == 0) {
                jQuery(this).remove();
            }
        });

        jQuery('.checkboxchg').change(function () {
            jQuery('.opc-ajax-loader').css('display', 'block');
            var bundproprice = jQuery(this).data('parentprice');
            var liprodid = jQuery(this).data('liprodid');
            var selectionprice = [];
            jQuery(".product_" + liprodid).each(function () {
                if (jQuery(this).is(':checkbox')) {
                    if (jQuery(this).is(':checked')) {
                        selectionprice.push(jQuery(this).attr("data-selectionpricevalue"));
                    }
                }
            });

            jQuery.ajax({
                'url': "<?php echo Mage::getUrl('customblocks/index/updateBundleproprice'); ?>",
                'type': "POST",
                'data': {bundproprice: bundproprice, selectionprice: selectionprice},
                success: function (data) {
                    jQuery('.opc-ajax-loader').css('display', 'none');
                    jQuery('.buy-details_' + liprodid + ' .price-info .price-box .regular-price').html(data);
                }
            });
        });

        jQuery('.shopping-cart-rule').click(function () {
            jQuery('.opc-ajax-loader').css('display', 'block');
            var bundid = jQuery(this).data('bunid');
            var selectionskus = [];
            jQuery(".product_" + bundid).each(function () {
                if (jQuery(this).is(':checkbox')) {
                    if (jQuery(this).is(':checked')) {
                        selectionskus.push(jQuery(this).data('productsku'));
                    }
                }
            });

            jQuery.ajax({
                'url': "<?php echo Mage::getUrl('customblocks/index/addShoppingPromoProToCart'); ?>",
                'type': "POST",
                'dataType': 'json',
                'data': {selectionskus: selectionskus},
                success: function (data) {
                    if (data.status == 'success')
                    {
                        jQuery('.opc-ajax-loader').css('display', 'none');
                        var base_url = "<?php echo Mage::getBaseUrl() . 'checkout/cart/'; ?>";
                        location.href = base_url;
                    } else if (data.status == 'error') {
                        jQuery('.opc-ajax-loader').css('display', 'none');
                        alert(data.message);
                    }
                }
            });
        });

        jQuery('.bundle-addto-cart').click(function () {
            jQuery('.opc-ajax-loader').css('display', 'block');
            var bundid = jQuery(this).data('bunid');
            var selectionids = [];
            var optionid = [];

            jQuery(".product_" + bundid).each(function () {
                if (jQuery(this).is(':checkbox')) {
                    if (jQuery(this).is(':checked')) {
                        selectionids.push(jQuery(this).attr("data-selectionid"));
                        optionid.push(jQuery(this).attr("data-optionid"));
                    }
                }
            });

            var option_id = jQuery.unique(optionid);

            var proid = jQuery(this).data('prodid');
            jQuery.ajax({
                'url': "<?php echo Mage::getUrl('customblocks/index/addBundledProducttToCart'); ?>",
                'type': "POST",
                'dataType': 'json',
                'data': {proid: proid, selectionids: selectionids, option_id: option_id},
                success: function (data) {
                    if (data.status == 'EmptySelectionIds') {
                        alert(data.message);
                        jQuery('.opc-ajax-loader').css('display', 'none');
                    } else if (data.status == 'Success') {
                        jQuery('.opc-ajax-loader').css('display', 'none');
                        var base_url = "<?php echo Mage::getBaseUrl() . 'checkout/cart/'; ?>";
                        location.href = base_url;
                    }
                }
            });
        });
    });
    function scrollto(element){
        jQuery('html, body').animate({ scrollTop: (jQuery(element).offset().top)-250}, 'slow');
    }
    jQuery('#pincodeCheck').on('keyup keypress', function(e) {
      var keyCode = e.keyCode || e.which;
      if (keyCode === 13) { 
        e.preventDefault();
        pincodeCheck(this.value);
        //return false;
      }
    });
    function pincodeCheck(postcode){
        if (postcode) {
                jQuery('.opc-ajax-loader').css('display', 'block');
                jQuery.ajax({
                    'url': "<?php echo Mage::getUrl('operations/index/checkPostcode'); ?>", //pincode/index/checkPostcode
                    'type': "POST",
                    'dataType': 'json',
                    'data': {postcode: postcode},
                    success: function (data) {
                        jQuery('.pincode_message_login').text('');
                        jQuery('.opc-ajax-loader').css('display', 'none');
                        if (data.status == 0) {
                            jQuery('.pincode_message').css({color:'red'});
                            jQuery('.pincode_message').text(data.message);
                        } else if (data.status == 1) {
                            jQuery('.pincode_message').css({color:'#11b400'});
                            jQuery('.pincode_message').text(data.message);
                        }
                    }
                });
            } else {
                jQuery('.pincode_message_login').text('');
                jQuery('.pincode_message').css({color:'red'});
                jQuery('.pincode_message').text("Please Enter Pincode");
                jQuery('.opc-ajax-loader').css('display', 'none');
            }
    }
/*
jQuery(".footer-top").mouseover(function(){
    alert(window.pageYOffset);
    //myFunction();
});    
*/
// When the user scrolls the page, execute myFunction 
</script>

 <script type="text/javascript">
 var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ? true : false;
     jQuery(function($){
        if(!isMobile) {
                var sOffset = $(".product-img-box").offset().top;
                var shareheight = $(".product-img-box").height();
                $(window).scroll(function() {
                    var scrollYpos = $(document).scrollTop();
                    if (scrollYpos > (sOffset - shareheight) + 700) {
                        $(".product-img-box").css({
                            'top': sOffset - 70,
                            'position': 'fixed'
                        });
                    } else {
                        $(".product-img-box").css({
                            'top': 'auto',
                            'position': 'relative'
                        });
                    }
                });
                $(window).scroll(function() {
                   if($('div').hasClass('products_homeslider'))
                   {
                      var footersection = $('.products_homeslider').prop('scrollHeight') + $('.footer-container').prop('scrollHeight');
                      //var test = $("")[0].scrollHeight;
                   }
                   else
                   {
                     var footersection = $('.footer-container').prop('scrollHeight');
                   } 
                   if(($(window).scrollTop() + $(window).height()) >= ($(document).height() - (footersection+50))) {
                       console.log($(document).height());
                       console.log(footersection);                       
                       $(".product-img-box").css({
                        'top': 'auto',
                        'position': 'relative'
                    });
                   }
              });
         }
     });
 </script>